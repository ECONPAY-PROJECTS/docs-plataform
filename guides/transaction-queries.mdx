---
title: "Guia de Consulta de Transa√ß√µes"
description: "Como consultar e sincronizar transa√ß√µes no EconPay"
---

## Vis√£o Geral

O EconPay oferece duas formas de consultar transa√ß√µes:

1. **Consulta Local** - Retorna dados do banco de dados (r√°pido, mas pode estar desatualizado)
2. **Consulta com Sincroniza√ß√£o** - Consulta na Firebank e sincroniza automaticamente (recomendado)

## üîç Consulta Local (Sem Sincroniza√ß√£o)

Retorna apenas os dados armazenados no banco de dados local.

```bash
GET /transactions/{id}
```

**Exemplo:**
```bash
curl --request GET \
  --url https://api.econpay.com.br/transactions/225 \
  --header 'Authorization: Bearer SEU_TOKEN'
```

**Resposta:**
```json
{
  "id": 225,
  "status": 1,
  "status_payment_name": "PENDING",  // Nome leg√≠vel
  "amount": 500,
  "type": "pix",
  "customer": { ... },
  "acquirer_status": null  // N√£o consulta na Firebank
}
```

**Quando usar:**
- Listagem r√°pida de transa√ß√µes
- Quando n√£o precisa do status mais recente
- Para economizar chamadas √† API da Firebank

---

## ‚úÖ Consulta com Sincroniza√ß√£o (Recomendado)

Consulta o status atualizado na Firebank e sincroniza automaticamente o status local.

```bash
GET /transactions/{id}?payment_type={TIPO}
```

### Tipos Suportados:
- `PIX` - Para pagamentos PIX
- `CREDIT_CARD` - Para cart√£o de cr√©dito
- `BILLET` - Para boleto banc√°rio

**Exemplo PIX:**
```bash
curl --request GET \
  --url 'https://api.econpay.com.br/transactions/225?payment_type=PIX' \
  --header 'Authorization: Bearer SEU_TOKEN'
```

**Resposta:**
```json
{
  "id": 225,
  "status": 2,
  "status_payment_name": "APPROVED",  // ‚úÖ Nome leg√≠vel
  "amount": 500,
  "type": "pix",
  "customer": { ... },
  "acquirer_status": {
    "id": "ee1456c0-66da-4eac-9f80-96fefb3e7f3b",
    "operation": {
      "status": "PAID",  // Status na Firebank
      "value": 5,
      "provider": "celcoin"
    },
    "history": [
      {
        "status": "WAITING_PAYMENT",
        "createdAt": "2025-10-28T21:59:45.068Z"
      },
      {
        "status": "PAID",
        "createdAt": "2025-10-28T22:00:04.192Z"
      }
    ],
    "payer": {
      "fullName": "Jo√£o da Silva",
      "document": "***380023**"
    }
  }
}
```

**Quando usar:**
- Verificar se um pagamento foi aprovado
- Obter dados atualizados do pagador
- Ver hist√≥rico de mudan√ßas de status
- Sincronizar status quando webhook falhar

---

## üîÑ Como Funciona a Sincroniza√ß√£o

Quando voc√™ usa `?payment_type=PIX`:

1. **Busca no banco local** - Pega os dados da transa√ß√£o
2. **Consulta na Firebank** - Busca status atualizado usando o `transactionId`
3. **Compara status** - Verifica se h√° diverg√™ncia
4. **Sincroniza automaticamente** - Atualiza o status local se necess√°rio
5. **Retorna dados completos** - Status sincronizado + dados da Firebank

### Mapeamento de Status

| Status Firebank | C√≥digo | Nome (`status_payment_name`) | Descri√ß√£o |
|-----------------|--------|------------------------------|-----------|
| `WAITING_CONFIRMATION` | 1 | `PENDING` | ‚è≥ Aguardando confirma√ß√£o |
| `WAITING_PAYMENT` | 1 | `PENDING` | ‚è≥ Aguardando pagamento |
| `PAID` | 2 | `APPROVED` | ‚úÖ Pago |
| `APPROVED` | 2 | `APPROVED` | ‚úÖ Aprovado |
| `FAILED` | 3 | `FAILED` | ‚ùå Falhou |
| `CANCELLED` | 3 | `FAILED` | ‚ùå Cancelado |
| `REFUNDED` | 4 | `REFUNDED` | üí∞ Estornado |

<Note>
  **Recomenda√ß√£o:** Use `status_payment_name` em vez de `status` para melhor legibilidade no c√≥digo.
</Note>

---

## üìä Exemplos Pr√°ticos

### Verificar se PIX foi Pago

```javascript
async function checkPixPayment(transactionId) {
  const response = await fetch(
    `https://api.econpay.com.br/transactions/${transactionId}?payment_type=PIX`,
    {
      headers: { 'Authorization': `Bearer ${token}` }
    }
  );
  
  const transaction = await response.json();
  
  // Status j√° vem sincronizado - usando nome leg√≠vel
  if (transaction.status_payment_name === 'APPROVED') {
    console.log('‚úÖ Pagamento aprovado!');
    console.log('Pago por:', transaction.acquirer_status.payer.fullName);
    console.log('Valor:', `R$ ${transaction.amount / 100}`);
    return true;
  }
  
  if (transaction.status_payment_name === 'PENDING') {
    console.log('‚è≥ Aguardando pagamento...');
    return false;
  }
  
  console.log('‚ùå Pagamento falhou');
  return false;
}

// Uso
const isPaid = await checkPixPayment(225);
```

### Obter Hist√≥rico de Status

```javascript
async function getPaymentHistory(transactionId) {
  const response = await fetch(
    `https://api.econpay.com.br/transactions/${transactionId}?payment_type=PIX`,
    {
      headers: { 'Authorization': `Bearer ${token}` }
    }
  );
  
  const transaction = await response.json();
  
  if (transaction.acquirer_status?.history) {
    console.log('üìú Hist√≥rico de Status:');
    transaction.acquirer_status.history.forEach(event => {
      const date = new Date(event.createdAt).toLocaleString('pt-BR');
      console.log(`${date} - ${event.status}`);
    });
  }
}
```

### Sincronizar M√∫ltiplas Transa√ß√µes

```javascript
async function syncPendingTransactions(transactionIds) {
  const results = await Promise.all(
    transactionIds.map(id =>
      fetch(
        `https://api.econpay.com.br/transactions/${id}?payment_type=PIX`,
        {
          headers: { 'Authorization': `Bearer ${token}` }
        }
      ).then(r => r.json())
    )
  );
  
  const approved = results.filter(t => t.status_payment_name === 'APPROVED');
  const pending = results.filter(t => t.status_payment_name === 'PENDING');
  
  console.log(`‚úÖ ${approved.length} aprovadas`);
  console.log(`‚è≥ ${pending.length} pendentes`);
  
  return { approved, pending };
}

// Sincronizar transa√ß√µes pendentes
const { approved, pending } = await syncPendingTransactions([225, 226, 227]);
```

---

## ‚ö†Ô∏è Importante

### Quando a Sincroniza√ß√£o N√ÉO Acontece

A sincroniza√ß√£o autom√°tica **n√£o atualiza** o status local se:

1. **Status j√° √© final** - Transa√ß√£o j√° est√° aprovada (2), falhada (3) ou estornada (4)
2. **Sem transactionId** - Falta o ID da transa√ß√£o na Firebank
3. **Erro na consulta** - Firebank est√° indispon√≠vel (retorna dados locais)

### Boas Pr√°ticas

‚úÖ **Fa√ßa:**
- Use `?payment_type=PIX` para verificar pagamentos pendentes
- Consulte com sincroniza√ß√£o quando webhook falhar
- Use consulta local para listagens r√°pidas

‚ùå **Evite:**
- Consultar com sincroniza√ß√£o em loops frequentes (use webhooks)
- Sincronizar transa√ß√µes j√° finalizadas (desnecess√°rio)
- Fazer polling constante (prefira webhooks)

---

## üîó Endpoints Relacionados

<CardGroup cols={2}>
  <Card title="Listar Transa√ß√µes" icon="list" href="/api-reference/transactions/list">
    Consultar m√∫ltiplas transa√ß√µes
  </Card>
  <Card title="Webhooks" icon="webhook" href="/guides/webhooks">
    Receber notifica√ß√µes autom√°ticas
  </Card>
  <Card title="Criar Pagamento" icon="credit-card" href="/api-reference/payments/create-payment">
    Processar novo pagamento
  </Card>
  <Card title="Reembolso" icon="rotate-left" href="/api-reference/payments/refund">
    Estornar transa√ß√£o
  </Card>
</CardGroup>

---

## üÜò Troubleshooting

### Status n√£o sincroniza

**Problema:** Status local continua PENDING mesmo ap√≥s pagamento

**Solu√ß√£o:**
1. Verifique se est√° usando `?payment_type=PIX`
2. Confirme que o `transactionId` existe no `response_data_subacquirer_integration`
3. Verifique logs do servidor para erros na consulta √† Firebank

### acquirer_status retorna null

**Problema:** Campo `acquirer_status` vem vazio

**Causas poss√≠veis:**
- N√£o forneceu o par√¢metro `payment_type`
- Transa√ß√£o n√£o tem `transactionId` da Firebank
- Erro na comunica√ß√£o com a Firebank

**Solu√ß√£o:** Adicione `?payment_type=PIX` na URL

### Webhook falhou mas status n√£o atualiza

**Problema:** Webhook retornou erro mas status continua PENDING

**Solu√ß√£o:** Use consulta com sincroniza√ß√£o:
```bash
GET /transactions/{id}?payment_type=PIX
```

Isso for√ßa a sincroniza√ß√£o mesmo quando o webhook falha.
